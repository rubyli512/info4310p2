<html>

<head>
    <title>INFO 4310 Project 2</title>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
</head>
<!-- css style for gridlines -->
<style>
    .gridlines line {
        stroke: rgb(223, 223, 223);
    }

    .gridlines .domain {
        stroke: none;
    }

    .state {
          fill: white;
        }

    .outline {
          fill: none;
          stroke: gray;
          stroke-width: 1px;
        }

</style>
<p id = "p1"> 
    <svg id="choropleth" height="700" width="700"></svg>
    <script>
        const svg = d3.select("#choropleth");
        const width_map = svg.attr("width");
        const height_map = svg.attr("height");
        const margin = { top: 20, right: 20, bottom: 20, left:20};
        const mapWidth = width_map - margin.left - margin.right;
        const mapHeight = height_map - margin.top - margin.bottom;
        const map = svg.append("g")
              .attr("transform","translate("+margin.left+","+margin.top+")");
              

        const requestData_map = async function() {

            const us = await d3.json("us-smaller.json");
            console.log(us);
        
            var states = topojson.feature(us, us.objects.states); 
            var statesMesh = topojson.mesh(us, us.objects.states);   
            var projection = d3.geoAlbersUsa().fitSize([mapWidth, mapHeight], states);
            var path = d3.geoPath().projection(projection);
            console.log(states);
            console.log(statesMesh);
            
            
            
            let statePaths = map.selectAll("path.state").data(states.features)
                            .join("path")
                            .attr("class", "state")
                            .attr("note", d => d.id)
                            .attr("d", path)
        
            map.append("path").datum(statesMesh)
            .attr("class","outline")
            .attr("d", path);
        
        }
        requestData_map();


    </script>

<svg id="graph" width="700 " height="700" style="margin: 20px"></svg>

<script>

    // select and set canvas
    const graph = d3.select("svg#graph");
    const margins = { top: 10, right: 10, bottom: 40, left: 40 };
    const width = graph.attr("width");
    const height = graph.attr("height");
    const graphWidth = width - margins.left - margins.right;
    const graphHeight = height - margins.top - margins.bottom;


    const getData = async function () {
        const data = await d3.csv("processed_df.csv");
    
        console.log(data);
        years = d3.extent(data, d => d.year)
        dataInitial = data.filter(d => d.year === years[0])

        // create 3 scales
        let hoursExtent = d3.extent(dataInitial, d => d.hours)
        let hoursScale = d3.scaleLinear().domain(hoursExtent).range([0, graphWidth]);
        let outputExtent = d3.extent(dataInitial, d => d.output)
        let outputScale = d3.scaleLinear().domain(outputExtent).range([graphHeight, 0]);
        let employScale = d3.scaleOrdinal(d3.schemeCategory10);

        // populate the axis
        let leftAxis = d3.axisLeft(outputScale);
        let bottomAxis = d3.axisBottom(hoursScale);

        // populate gridlines
        let leftGridlines = d3.axisLeft(outputScale).tickFormat('').tickSize(-graphWidth - 10);
        let bottomGridlines = d3.axisBottom(hoursScale).tickFormat('').tickSize(-graphHeight - 10);

        // create 5 g elements    
        graph.append("g").attr("transform", `translate(${margins.left - 10},${margins.top})`).attr("class", "axis").call(leftAxis);
        graph.append('g').attr("transform", `translate(${margins.left},${margins.top + graphHeight + 10})`).attr("class", "axis").call(bottomAxis);
        graph.append('g').attr("transform", `translate(${margins.left - 10},${margins.top})`).attr('class', 'gridlines').call(leftGridlines);
        graph.append('g').attr("transform", `translate(${margins.left},${graphHeight + margins.top + 10})`).attr('class', 'gridlines').call(bottomGridlines);
        let chartArea = graph.append('g').attr("transform", `translate(${margins.left},${margins.top})`).attr("class", "chart");

        // append new circles to chart
        chartArea.selectAll("circle").data(dataInitial).join("circle").attr("fill", "lightblue").attr("cx", d => hoursScale(d.hours)).attr("cy", d => outputScale(d.output)).attr("r", d => employScale(d.employment)).attr("opacity", 0.8);
    }

    // call the function
    getData();

</script>

<body>

</body>

</html>
